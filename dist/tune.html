<!DOCTYPE html>
<html lang="en"> 
<head>
    <title>ceol.io</title>
    
    <!-- Meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <meta name="description" content="Index">
    <link rel="shortcut icon" href="./images/ceol.io.1.ico" >
    <link rel="favicon" href="./images/ceol.io.1.ico" >
    <!-- <link rel="shortcut icon" href="favicon.ico"> -->
    
    <!-- Google Font -->
    <link href="https://fonts.googleapis.com/css?family=Poppins:300,400,500,600,700&display=swap" rel="stylesheet">
    
    <!-- Theme CSS -->  
    <link id="theme-style" rel="stylesheet" href="./theme.css">

</head> 

<header class="header fixed-top">	    
    <div class="branding docs-branding">
        <div class="container-fluid position-relative py-2">
            <div class="docs-logo-wrapper">
                <div class="site-logo"><a class="navbar-brand" href="../../../"><img width="150" src="./images/logo1.png" alt="logo"><span class="logo-text" style="font-weight: 50;">Traditional Irish Session Logs</span></a></div>
            </div><!--//docs-logo-wrapper-->
            <div class="docs-top-utilities d-flex justify-content-end align-items-center">

                <ul class="list-inline mx-md-3 mb-0 d-none d-lg-flex">
                    <!-- <li class="list-inline-item"><a href="#"><i class="fab fa-product-hunt fa-fw"></i></a></li> -->
                </ul><!--//social-list-->
                
            </div><!--//docs-top-utilities-->
        </div><!--//container-->
    </div><!--//branding-->
</header><!--//header-->

<body class="docs-page">    
    <div class="docs-wrapper">
	    <div class="docs-content">
        <div class="landing-page" style="display: block;">

<h2 id="subcategories"><a href="../">Austin, TX</a> â€¢ BD Riley's @ Mueller</h2>

    <script>
        async function fetchTopTunes() {
            try {
                const response = await fetch('/top-tunes');
                if (!response.ok) {
                    throw new Error('Network response was not ok ' + response.statusText);
                }
                const data = await response.json();
                populateTopTunes(data);
            } catch (error) {
                console.error('Error fetching the top tunes:', error);
                document.getElementById('tune-table-body').innerHTML = `<tr><td colspan="2">Error fetching data. Please try again later.</td></tr>`;
            }
        }

        function populateTopTunes(tunes) {
            const tableBody = document.getElementById('tune-table-body');
            tableBody.innerHTML = ''; // Clear existing rows

            tunes.forEach(tune => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>
                      <a href="${tune.session_url}">${tune.name}</a>
                        <span class="count"> (${tune.tune_count})</span>
                    </td>
                `;
                tableBody.appendChild(row);
            });
        }


        async function fetchSessions() {
            try {
                const response = await fetch('/sessions');
                if (!response.ok) {
                    throw new Error('Network response was not ok ' + response.statusText);
                }
                const data = await response.json();
                populateSessions(data);
            } catch (error) {
                console.error('Error fetching the top tunes:', error);
                document.getElementById('tune-table-body').innerHTML = `<tr><td colspan="2">Error fetching data. Please try again later.</td></tr>`;
            }
        }

        function populateSessions(sessions) {
            const sessionBody = document.getElementById('sessions-body');
            sessionBody.innerHTML = ''; // Clear existing rows
            let block = document.createElement('ul');
            let currentYear = sessions[0].session_date.split('-')[0]
          console.log(currentYear)

            sessions.forEach(session => {
                if(session.session_date.split('-')[0] != currentYear){
                  let title = document.createElement('p');
                  title.innerHTML = `<strong>${currentYear}</strong>`
                  sessionBody.appendChild(title)
                  sessionBody.appendChild(block)
                  block = document.createElement('ul')
                  currentYear = session.session_date.split('-')[0]
                }
                block.innerHTML += `
                    <li>
                      <a href="tune.html?session_id=${session.session_id}">${session.session_date}</a>
                    </li>
                `;
            });
            let title = document.createElement('p');
            title.innerHTML = `<strong>${currentYear}</strong>`
            sessionBody.appendChild(title)
            sessionBody.appendChild(block)
            block = document.createElement('ul')
        }


        async function initPageData() {
          await fetchTopTunes();
          await fetchSessions();
        }

        // Fetch top tunes when the page loads
        document.addEventListener('DOMContentLoaded', initPageData);
    </script>

<!-- end landing page -->
</div>

</div>
</div>

</body>
</html>

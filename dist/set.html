<!DOCTYPE html>
<html lang="en"> 
<head>
    <title>ceol.io</title>
    
    <!-- Meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <meta name="description" content="Index">
    <link rel="shortcut icon" href="./images/ceol.io.1.ico" >
    <link rel="favicon" href="./images/ceol.io.1.ico" >
    <!-- <link rel="shortcut icon" href="favicon.ico"> -->
    
    <!-- Google Font -->
    <link href="https://fonts.googleapis.com/css?family=Poppins:300,400,500,600,700&display=swap" rel="stylesheet">
    
    <!-- Theme CSS -->  
    <link id="theme-style" rel="stylesheet" href="./theme.css">
    <link rel="stylesheet" href="https://www.abcjs.net/abcjs-audio.css" type="text/css">
    <style>
		.abcjs-inline-audio {
			max-width: 770px;
		}
	</style>
</head> 

<header class="header fixed-top">	    
    <div class="branding docs-branding">
        <div class="container-fluid position-relative py-2">
            <div class="docs-logo-wrapper">
                <div class="site-logo"><a class="navbar-brand" href="../../../"><img width="150" src="./images/logo1.png" alt="logo"><span class="logo-text" style="font-weight: 50;">Traditional Irish Session Logs</span></a></div>
            </div><!--//docs-logo-wrapper-->
            <div class="docs-top-utilities d-flex justify-content-end align-items-center">

                <ul class="list-inline mx-md-3 mb-0 d-none d-lg-flex">
                    <!-- <li class="list-inline-item"><a href="#"><i class="fab fa-product-hunt fa-fw"></i></a></li> -->
                </ul><!--//social-list-->
                
            </div><!--//docs-top-utilities-->
        </div><!--//container-->
    </div><!--//branding-->
</header><!--//header-->

<body class="docs-page">    
    <div class="docs-wrapper">
	    <div class="docs-content">
        <div class="landing-page" style="display: block;">

<h2 id="subcategories"><a href="../">Austin, TX</a> â€¢ BD Riley's @ Mueller</h2>

<h3>Tunes:</h3>

<ul id="tunes-body"></ul>
<button id="audio-button"></button>
<label for="volumeControl">Volume:</label>
<input type="range" id="volumeControl" min="0" max="1" step="0.01" value="0.5">
<select id="soundfonts">
    <option value="https://gleitz.github.io/midi-js-soundfonts/MusyngKite/">Musyng Kite Soundfont</option>
    <option value="https://gleitz.github.io/midi-js-soundfonts/FluidR3_GM/">Fluid Soundfont</option>
    <option value="https://gleitz.github.io/midi-js-soundfonts/FatBoy/">FatBoy Soundfont</option>
    <option value="https://gleitz.github.io/midi-js-soundfonts/Tabla/">Tabla Soundfont</option>
</select>
<select id="instrument-picker">
  <option value="0">Acoustic Piano</option>
  <option value="4">Electric Piano</option>
  <option value="6">Harpsichord</option>
  <option value="7">Clavi</option>
  <option value="8">Celesta</option>
  <option value="23">Tango Accordion</option>
  <option value="24">Acoustic Guitar (nylon)</option>
  <option value="25">Acoustic Guitar (steel)</option>
  <option value="26">Electric Guitar (jazz)</option>
  <option value="56">Trumpet</option>
  <option value="57">Trombone</option>
  <option value="58">Tuba</option>
  <option value="59">Muted Trumpet</option>
  <option value="60">French Horn</option>
</select>

<div id="notation"></div>
<div id="audio"></div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/abcjs/6.0.0/abcjs-basic.min.js"></script>
    <script>

        var synthControl;
        var visualObj;


        async function fetchTunes(set_id) {
          let abcNotation = ''
            try {
              const response = await fetch(`/set?set_id=${set_id}`);
                if (!response.ok) {
                    throw new Error('Network response was not ok ' + response.statusText);
                }
                const data = await response.json();
                abcNotation = populateTunes(data);
            } catch (error) {
                console.error('Error fetching the top tunes:', error);
                document.getElementById('tunes-body').innerHTML = `<tr><td colspan="2">Error fetching data. Please try again later.</td></tr>`;
            }
          return abcNotation;
        }
        function populateTunes(tunes){
            const tableBody = document.getElementById('tunes-body');
            tableBody.innerHTML = ''; // Clear existing rows

            let count = 1
            let abcNotation = []
            tunes.forEach(tune => {
                const row = document.createElement('li');
                row.innerHTML = `
                      <a href="tune.html?tune_id=${tune.tune_id}">${tune.name}</a><br />
                      <a href="${tune.tune_url}">${tune.tune_url}</a>
                `;
                tableBody.appendChild(row);
                abcNotation.push(
                '\n\n' +
                `X: ${count}\n` +
                `T: ${tune.name}\n` +
                `M: ${tune.tune_meter}\n` +
                `K: ${tune.tune_mode}\n` +
                tune.abc)

                count++
            });
          return abcNotation;
        }


        async function initPageData() {
          const params = new URLSearchParams(window.location.search); // Get query parameters
          const abcNotation = await fetchTunes(params.get('set_id'));
          const audio_button = document.getElementById('audio-button');
          audio_button.textContent = "Show ABC Notation"
          audio_button.onclick = function() {
            abcNotation.forEach(abc => {
              renderAudio(abc)
            })
          }
        }

        function renderAudio(abcNotation) {
            console.log(abcNotation)
          if (ABCJS.synth.supportsAudio()) {
              visualObj = ABCJS.renderAbc('notation', abcNotation)[0];
              synthControl = new ABCJS.synth.SynthController();
              synthControl.load("#audio", null, {displayRestart: true, displayPlay: true, displayProgress: true});
              const volume = parseFloat(document.getElementById('volumeControl').value)
              const instrument = Number(document.getElementById('instrument-picker').value)
              const fontURL = document.getElementById('soundfonts').value
              synthControl.setTune(visualObj, false, {
              soundFontVolumeMultiplier: volume, 
              soundFontUrl: fontURL,
              program: instrument,
              });
            } else {
              document.querySelector("#audio").innerHTML = "<div class='audio-error'>Audio is not supported in this browser.</div>";
          }
        }

        // Fetch top tunes when the page loads
        document.addEventListener('DOMContentLoaded', initPageData, { responsive: 'resize' });
    </script>

<!-- end landing page -->
</div>

</div>
</div>

</body>
</html>
